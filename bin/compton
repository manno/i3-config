#!/bin/zsh
COMPTON=/sbin/compton
set +e


case "$1" in
  start) 
    $COMPTON -b --dbus
    ;;
  stop)
    pkill -u $USER -f $COMPTON
    ;;
  reset|restart)
    pkill -u $USER -f $COMPTON
    $COMPTON -b --dbus
    ;;

  status)
    pidof $COMPTON
    ;;
  reload)
    dpy=$(echo -n "$DISPLAY" | tr -c '[:alnum:]' _)

    if [ -z "$dpy" ]; then
      echo "Cannot find display."
      exit 1
    fi

    service="com.github.chjj.compton.${dpy}"
    interface='com.github.chjj.compton'
    object='/com/github/chjj/compton'
    dbus-send --print-reply --dest="$service" "$object" "${interface}.reset"
    ;;
esac

exit 0
